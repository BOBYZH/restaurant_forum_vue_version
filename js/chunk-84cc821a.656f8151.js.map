{"version":3,"sources":["webpack:///./src/components/AdminRestaurantForm.vue","webpack:///./src/components/AdminRestaurantForm.vue?ff39","webpack:///./src/views/AdminRestaurantNew.vue","webpack:///./src/views/AdminRestaurantNew.vue?e3e1","webpack:///./src/apis/admin.js"],"names":["class","_createElementVNode","for","value","selected","disabled","$data","_createBlock","_component_Spinner","key","_createElementBlock","onSubmit","$options","_hoisted_2","id","name","$event","type","placeholder","required","_hoisted_4","categoryId","_hoisted_5","_Fragment","_renderList","category","_hoisted_6","_hoisted_8","tel","_hoisted_10","address","_hoisted_12","openingHours","_hoisted_14","description","rows","_hoisted_16","image","src","width","height","accept","onChange","_ctx","_hoisted_18","components","Spinner","props","initialRestaurant","Object","default","CategoryId","isProcessing","Boolean","emits","data","categories","restaurant","this","isLoading","watch","newValue","created","fetchCategories","methods","adminAPI","get","status","Error","message","console","error","Toast","fire","icon","title","handleFileChange","e","files","target","length","imageURL","window","URL","createObjectURL","handleSubmit","form","formData","FormData","$emit","render","_createVNode","_component_AdminRestaurantForm","is-processing","onAfterSubmit","AdminRestaurantForm","handleAfterSubmit","restaurants","create","$router","push","getDetail","apiHelper","post","update","put","delete","restaurantId","users","userId","isAdmin"],"mappings":"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","file":"js/chunk-84cc821a.656f8151.js","sourcesContent":["<template>\r\n  <!-- 在 isLoading 為 false 時才將表單顯示出來 -->\r\n  <Spinner v-if=\"isLoading\" />\r\n  <form\r\n    v-show=\"!isLoading\"\r\n    v-else\r\n    @submit.stop.prevent=\"handleSubmit\"\r\n  >\r\n    <div class=\"form-group\">\r\n      <label for=\"name\">Name</label>\r\n      <input\r\n        id=\"name\"\r\n        v-model=\"restaurant.name\"\r\n        type=\"text\"\r\n        class=\"form-control\"\r\n        name=\"name\"\r\n        placeholder=\"Enter name\"\r\n        required\r\n      >\r\n    </div>\r\n\r\n    <div class=\"form-group\">\r\n      <label for=\"categoryId\">Category</label>\r\n      <select\r\n        id=\"categoryId\"\r\n        v-model=\"restaurant.categoryId\"\r\n        class=\"form-control\"\r\n        name=\"categoryId\"\r\n        required\r\n      >\r\n        <option\r\n          value=\"\"\r\n          selected\r\n          disabled\r\n        >\r\n          --請選擇--\r\n        </option>\r\n        <option\r\n          v-for=\"category in categories\"\r\n          :key=\"category.id\"\r\n          :value=\"category.id\"\r\n        >\r\n          {{ category.name }}\r\n        </option>\r\n      </select>\r\n    </div>\r\n\r\n    <div class=\"form-group\">\r\n      <label for=\"tel\">Tel</label>\r\n      <input\r\n        id=\"tel\"\r\n        v-model=\"restaurant.tel\"\r\n        type=\"text\"\r\n        class=\"form-control\"\r\n        name=\"tel\"\r\n        placeholder=\"Enter telephone number\"\r\n      >\r\n    </div>\r\n\r\n    <div class=\"form-group\">\r\n      <label for=\"address\">Address</label>\r\n      <input\r\n        id=\"address\"\r\n        v-model=\"restaurant.address\"\r\n        type=\"text\"\r\n        class=\"form-control\"\r\n        placeholder=\"Enter address\"\r\n        name=\"address\"\r\n      >\r\n    </div>\r\n\r\n    <div class=\"form-group\">\r\n      <label for=\"opening-hours\">Opening Hours</label>\r\n      <input\r\n        id=\"opening-hours\"\r\n        v-model=\"restaurant.openingHours\"\r\n        type=\"time\"\r\n        class=\"form-control\"\r\n        name=\"opening_hours\"\r\n      >\r\n    </div>\r\n\r\n    <div class=\"form-group\">\r\n      <label for=\"description\">Description</label>\r\n      <textarea\r\n        id=\"description\"\r\n        v-model=\"restaurant.description\"\r\n        class=\"form-control\"\r\n        rows=\"3\"\r\n        name=\"description\"\r\n      />\r\n    </div>\r\n\r\n    <div class=\"form-group\">\r\n      <label for=\"image\">Image</label>\r\n      <img\r\n        v-if=\"restaurant.image\"\r\n        :src=\"restaurant.image\"\r\n        class=\"d-block img-thumbnail mb-3\"\r\n        width=\"200\"\r\n        height=\"200\"\r\n      >\r\n\r\n      <input\r\n        id=\"image\"\r\n        type=\"file\"\r\n        name=\"image\"\r\n        accept=\"image/*\"\r\n        class=\"form-control-file\"\r\n        @change=\"handleFileChange\"\r\n      >\r\n    </div>\r\n\r\n    <button\r\n      type=\"submit\"\r\n      class=\"btn btn-primary\"\r\n      :disabled=\"isProcessing\"\r\n    >\r\n      {{ isProcessing ? \"處理中...\" : \"送出\" }}\r\n    </button>\r\n  </form>\r\n</template>\r\n\r\n<script>\r\n// STEP 1: 匯入 adminAPI 和錯誤提示用的 Toast\r\nimport adminAPI from './../apis/admin'\r\nimport { Toast } from './../utils/helpers'\r\nimport Spinner from './../components/Spinner'\r\n\r\nexport default { // 用 default 設定一組預設值\r\n  name: 'AdminRestaurantForm',\r\n  components: {\r\n    Spinner\r\n  },\r\n  props: {\r\n    initialRestaurant: {\r\n      type: Object,\r\n      /*\r\n        為物件或陣列類型的資料設定預設值時，大括弧裡面的文字會被解析為有序宣告，\r\n        而不是物件的 key ，要記得把物件字面值包在圓括弧內\r\n       */\r\n      default: () => {\r\n        return {\r\n          name: '',\r\n          CategoryId: '',\r\n          tel: '',\r\n          address: '',\r\n          description: '',\r\n          image: '',\r\n          openingHours: ''\r\n        }\r\n      },\r\n      isProcessing: {\r\n        type: Boolean,\r\n        default: false\r\n      }\r\n    }\r\n  },\r\n  emits: ['after-submit'],\r\n  data () {\r\n    return {\r\n      categories: [],\r\n      restaurant: {\r\n        ...this.initialRestaurant\r\n      },\r\n      isLoading: true\r\n    }\r\n  },\r\n  // 利用 watch 來監控 initialRestaurant，一旦 API 回傳，initialRestaurant就會變更以更新 restaurant資料\r\n  watch: {\r\n    initialRestaurant (newValue) {\r\n      this.restaurant = {\r\n        ...this.restaurant,\r\n        ...newValue\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    // 畫面第一次渲染出來的時候，把各種資料呈現在樣板上\r\n    this.fetchCategories()\r\n    this.restaurant = {\r\n      // 第一步先展開 data 裡的預設值，也就是空白表單\r\n      ...this.restaurant,\r\n      // 接著展開 props 裡的資料，也就是父層傳進來的資料；\r\n      // 如果沒有資料，就調動 default 的回傳值，仍然是空白表單\r\n      ...this.initialRestaurant\r\n    }\r\n  },\r\n  methods: {\r\n    // STEP 2: 改成 async...await 語法\r\n    async fetchCategories () {\r\n      try {\r\n        // STEP 3: 向伺服器取得餐廳類別清單\r\n        const { data } = await adminAPI.categories.get()\r\n\r\n        if (data.status === 'error') { // 避免尚未收到資料時渲染空白結果\r\n          throw new Error(data.message)\r\n        }\r\n\r\n        this.categories = data.categories\r\n        this.isLoading = false\r\n      } catch (error) {\r\n        console.error(error.message)\r\n        this.isLoading = false\r\n        // STEP 4: 在 catch 中進行錯誤處理\r\n        Toast.fire({\r\n          icon: 'error',\r\n          title: '無法取得餐廳類別，請稍後再試'\r\n        })\r\n      }\r\n    },\r\n\r\n    handleFileChange (e) {\r\n      const { files } = e.target\r\n\r\n      if (files.length === 0) {\r\n        // 使用者沒有選擇上傳的檔案\r\n        this.restaurant.image = ''\r\n      } else {\r\n        // 否則產生預覽圖\r\n        const imageURL = window.URL.createObjectURL(files[0])\r\n        this.restaurant.image = imageURL\r\n      }\r\n    },\r\n    handleSubmit (e) { // 將表單資料轉成 FormData 物件\r\n      // 避免使用者漏填\r\n      if (!this.restaurant.name) {\r\n        Toast.fire({\r\n          icon: 'warning',\r\n          title: '請填寫餐廳名稱'\r\n        })\r\n        return\r\n      } else if (!this.restaurant.categoryId) {\r\n        Toast.fire({\r\n          icon: 'warning',\r\n          title: '請選擇餐廳類別'\r\n        })\r\n        return\r\n      }\r\n\r\n      const form = e.target // 取得表單本身<form></form>\r\n      const formData = new FormData(form) // 產生物件實例\r\n      // 傳遞給父層頁面，直接透過 $emit 發送一個叫做 after-submit 的事件，同時攜帶表單資料\r\n      this.$emit('after-submit', formData)\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import { render } from \"./AdminRestaurantForm.vue?vue&type=template&id=5dfe60be\"\nimport script from \"./AdminRestaurantForm.vue?vue&type=script&lang=js\"\nexport * from \"./AdminRestaurantForm.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\r\n  <div class=\"container py-5\">\r\n    <!-- 監聽來自子元件的 after-submit 事件，若收到事件，就觸發 handleAfterSubmit 函式 -->\r\n    <AdminRestaurantForm\r\n      :is-processing=\"isProcessing\"\r\n      @after-submit=\"handleAfterSubmit\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport AdminRestaurantForm from './../components/AdminRestaurantForm.vue'\r\nimport adminAPI from './../apis/admin'\r\nimport { Toast } from './../utils/helpers'\r\n\r\nexport default {\r\n  components: {\r\n    AdminRestaurantForm\r\n  },\r\n  data () {\r\n    return {\r\n      restaurant: {\r\n        isProcessing: false // 定義是否正在處理中的狀態\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    async handleAfterSubmit (formData) {\r\n      /*\r\n      模擬透過 API 將表單資料送到伺服器：\r\n      要取得表單的內容，需要透過 entries() 方法來逐條列出表單的欄位和值\r\n      */\r\n      // for (const [name, value] of formData.entries()) {\r\n      //   console.log(name + ': ' + value)\r\n      // }\r\n      try {\r\n        this.isProcessing = true\r\n        // 透過 restaurants.create向伺服器呼叫API來建立一筆餐廳資料\r\n        const { data } = await adminAPI.restaurants.create({\r\n          formData\r\n        })\r\n\r\n        if (data.status !== 'success') {\r\n          throw new Error(data.message)\r\n        }\r\n\r\n        this.$router.push({ name: 'admin-restaurants' })\r\n      } catch (error) {\r\n        Toast.fire({\r\n          icon: 'error',\r\n          title: '無法建立餐廳，請稍後再試'\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import { render } from \"./AdminRestaurantNew.vue?vue&type=template&id=77ea6fac\"\nimport script from \"./AdminRestaurantNew.vue?vue&type=script&lang=js\"\nexport * from \"./AdminRestaurantNew.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { apiHelper } from './../utils/helpers'\r\n\r\nexport default {\r\n  categories: {\r\n    getDetail ({ categoryId }) {\r\n      return apiHelper.get(`/admin/categories/${categoryId}`)\r\n    },\r\n    get () {\r\n      return apiHelper.get('/admin/categories')\r\n    },\r\n    create ({ name }) {\r\n      return apiHelper.post('/admin/categories', { name })\r\n    },\r\n    update ({ categoryId, name }) {\r\n      return apiHelper.put(`/admin/categories/${categoryId}`, { name })\r\n    },\r\n    delete ({ categoryId }) {\r\n      return apiHelper.delete(`/admin/categories/${categoryId}`)\r\n    }\r\n  },\r\n  restaurants: {\r\n    getDetail ({ restaurantId }) {\r\n      return apiHelper.get(`/admin/restaurants/${restaurantId}`)\r\n    },\r\n    get () {\r\n      return apiHelper.get('/admin/restaurants')\r\n    },\r\n    create ({ formData }) {\r\n      return apiHelper.post('/admin/restaurants', formData)\r\n    },\r\n    update ({ restaurantId, formData }) {\r\n      return apiHelper.put(`/admin/restaurants/${restaurantId}`, formData)\r\n    },\r\n    delete ({ restaurantId }) {\r\n      return apiHelper.delete(`/admin/restaurants/${restaurantId}`)\r\n    }\r\n  },\r\n  users: {\r\n    get () {\r\n      return apiHelper.get('/admin/users')\r\n    },\r\n    update ({ userId, isAdmin }) {\r\n      return apiHelper.put(\r\n        `/admin/users/${userId}`,\r\n        { isAdmin }\r\n      )\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":""}