{"version":3,"sources":["webpack:///./src/views/UserEdit.vue","webpack:///./src/views/UserEdit.vue?bccd"],"names":["class","_createElementVNode","for","type","_createElementBlock","onSubmit","$options","_hoisted_3","id","$data","$event","name","placeholder","required","_hoisted_5","src","width","height","accept","onChange","_toDisplayString","beforeRouteUpdate","to","from","next","this","currentUser","params","setUser","data","image","email","isProcessing","computed","mapState","watch","user","$route","created","methods","userId","toString","$router","push","handleFileChange","e","files","target","length","imageURL","window","URL","createObjectURL","handleSubmit","Toast","fire","icon","title","form","formData","FormData","usersAPI","update","status","Error","message","console","error","render"],"mappings":"oJACOA,MAAM,kB,GAEFA,MAAM,c,EACTC,eAA8B,SAAvBC,IAAI,QAAO,QAAI,G,GAYnBF,MAAM,c,EACTC,eAAgC,SAAzBC,IAAI,SAAQ,SAAK,G,aAoBxBC,KAAK,SACLH,MAAM,mB,gDArCZI,eA0CM,MA1CN,EA0CM,CAzCJH,eAwCO,QAxCAI,SAAM,8CAAeC,oDAAY,sBAAxC,CACEL,eAWM,MAXN,EAWM,CAVJM,EAUI,eATJN,eAQC,SAPCO,GAAG,O,qDACMC,OAAIC,IACbP,KAAK,OACLQ,KAAK,OACLX,MAAM,eACNY,YAAY,aACZC,SAAA,IAPF,mBAEWJ,YASbR,eAkBM,MAlBN,EAkBM,CAjBJa,EAEQL,0BADRL,eAMC,O,MAJEW,IAAKN,QACNT,MAAM,6BACNgB,MAAM,MACNC,OAAO,OALT,iCAQAhB,eAOC,SANCO,GAAG,QACHL,KAAK,OACLQ,KAAK,QACLO,OAAO,UACPlB,MAAM,oBACLmB,SAAM,8BAAEb,6DANX,WAUFL,eAKS,SALT,EAKSmB,eADJX,eAAY,yBAtCnB,M,4HAkDW,GACbY,kBADa,SACMC,EAAIC,EAAMC,GAC3B,IAA6B,IAAzBC,KAAKC,YAAYlB,GAArB,CADiC,IAEzBA,EAAOc,EAAGK,OAAVnB,GACRiB,KAAKG,QAAQpB,GACbgB,MAEFK,KAPa,WAQX,MAAO,CACLrB,GAAI,EACJsB,MAAO,GACPnB,KAAM,GACNoB,MAAO,GACPC,cAAc,IAGlBC,SAAU,kBACLC,eAAS,CAAC,iBAEfC,MAAO,CACLT,YADK,SACQU,GACX,IAAiB,IAAbA,EAAK5B,GAAT,CADiB,IAETA,EAAOiB,KAAKY,OAAOV,OAAnBnB,GACRiB,KAAKG,QAAQpB,MAGjB8B,QA1Ba,WA2BX,IAA6B,IAAzBb,KAAKC,YAAYlB,GAArB,CADS,IAEDA,EAAOiB,KAAKY,OAAOV,OAAnBnB,GACRiB,KAAKG,QAAQpB,KAEf+B,QAAS,CACPX,QADO,SACEY,GAAQ,MACoBf,KAAKC,YAAhClB,EADO,EACPA,GAAIsB,EADG,EACHA,MAAOnB,EADJ,EACIA,KAAMoB,EADV,EACUA,MAGrBvB,EAAGiC,aAAeD,EAAOC,YAK7BhB,KAAKjB,GAAKA,EACViB,KAAKd,KAAOA,EACZc,KAAKM,MAAQA,EACbN,KAAKK,MAAQA,GAPXL,KAAKiB,QAAQC,KAAK,CAAEhC,KAAM,eAS9BiC,iBAfO,SAeWC,GAChB,IAAMC,EAAQD,EAAEE,OAAOD,MACvB,GAAKA,EAAME,OAAX,CACA,IAAMC,EAAWC,OAAOC,IAAIC,gBAAgBN,EAAM,IAClDrB,KAAKK,MAAQmB,IAETI,aArBC,SAqBaR,GAAG,gLAGd,EAAKlC,KAHS,uBAIjB2C,OAAMC,KAAK,CACTC,KAAM,UACNC,MAAO,YANQ,iCAWbC,EAAOb,EAAEE,OACTY,EAAW,IAAIC,SAASF,GAE9B,EAAK1B,cAAe,EAdD,SAgBI6B,OAASC,OAAO,CACrCtB,OAAQ,EAAKhC,GACbmD,aAlBiB,mBAgBX9B,EAhBW,EAgBXA,KAIY,UAAhBA,EAAKkC,OApBU,uBAqBX,IAAIC,MAAMnC,EAAKoC,SArBJ,QAyBnB,EAAKvB,QAAQC,KAAK,CAAEhC,KAAM,OAAQgB,OAAQ,CAAEnB,GAAI,EAAKA,MAzBlC,qDA8BnB0D,QAAQC,MAAM,KAAMF,SACpB,EAAKjC,cAAe,EACpBsB,OAAMC,KAAK,CACTC,KAAM,QACNC,MAAO,oBAlCU,+DCrG3B,EAAOW,OAASA,EAED","file":"js/chunk-2d228901.1be04bc5.js","sourcesContent":["<template>\r\n  <div class=\"container py-5\">\r\n    <form @submit.stop.prevent=\"handleSubmit\">\r\n      <div class=\"form-group\">\r\n        <label for=\"name\">Name</label>\r\n        <input\r\n          id=\"name\"\r\n          v-model=\"name\"\r\n          type=\"text\"\r\n          name=\"name\"\r\n          class=\"form-control\"\r\n          placeholder=\"Enter Name\"\r\n          required\r\n        >\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <label for=\"image\">Image</label>\r\n        <img\r\n          v-if=\"image\"\r\n          :src=\"image\"\r\n          class=\"d-block img-thumbnail mb-3\"\r\n          width=\"200\"\r\n          height=\"200\"\r\n        >\r\n\r\n        <input\r\n          id=\"image\"\r\n          type=\"file\"\r\n          name=\"image\"\r\n          accept=\"image/*\"\r\n          class=\"form-control-file\"\r\n          @change=\"handleFileChange\"\r\n        >\r\n      </div>\r\n\r\n      <button\r\n        type=\"submit\"\r\n        class=\"btn btn-primary\"\r\n      >\r\n        {{ isProcessing ? '資料更新中...' : 'Submit' }}\r\n      </button>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapState } from 'vuex'\r\n\r\nimport usersAPI from './../apis/users'\r\nimport { Toast } from './../utils/helpers'\r\n\r\nexport default {\r\n  beforeRouteUpdate (to, from, next) {\r\n    if (this.currentUser.id === -1) return\r\n    const { id } = to.params\r\n    this.setUser(id)\r\n    next()\r\n  },\r\n  data () {\r\n    return {\r\n      id: 0,\r\n      image: '',\r\n      name: '',\r\n      email: '',\r\n      isProcessing: false\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['currentUser'])\r\n  },\r\n  watch: {\r\n    currentUser (user) {\r\n      if (user.id === -1) return // 未登入無法進入編輯頁面\r\n      const { id } = this.$route.params\r\n      this.setUser(id)\r\n    }\r\n  },\r\n  created () {\r\n    if (this.currentUser.id === -1) return\r\n    const { id } = this.$route.params\r\n    this.setUser(id)\r\n  },\r\n  methods: {\r\n    setUser (userId) {\r\n      const { id, image, name, email } = this.currentUser\r\n\r\n      // 只能編輯自己的資料\r\n      if (id.toString() !== userId.toString()) {\r\n        this.$router.push({ name: 'not-found' })\r\n        return\r\n      }\r\n\r\n      this.id = id\r\n      this.name = name\r\n      this.email = email\r\n      this.image = image\r\n    },\r\n    handleFileChange (e) {\r\n      const files = e.target.files\r\n      if (!files.length) return\r\n      const imageURL = window.URL.createObjectURL(files[0])\r\n      this.image = imageURL\r\n    },\r\n    async handleSubmit (e) {\r\n      try {\r\n        // 避免未填寫即將資料送出\r\n        if (!this.name) {\r\n          Toast.fire({\r\n            icon: 'warning',\r\n            title: '您尚未填寫姓名'\r\n          })\r\n          return\r\n        }\r\n\r\n        const form = e.target\r\n        const formData = new FormData(form)\r\n\r\n        this.isProcessing = true\r\n        // 透過 API 向伺服器更新使用者\r\n        const { data } = await usersAPI.update({\r\n          userId: this.id,\r\n          formData\r\n        })\r\n        if (data.status === 'error') {\r\n          throw new Error(data.message)\r\n        }\r\n\r\n        // 更新成功後導向到使用者資料頁面\r\n        this.$router.push({ name: 'user', params: { id: this.id } })\r\n        // for (const [name, value] of formData.entries()) {\r\n        //   console.log(name + ': ' + value)\r\n        // }\r\n      } catch (error) {\r\n        console.error(error.message)\r\n        this.isProcessing = false\r\n        Toast.fire({\r\n          icon: 'error',\r\n          title: '無法更新使用者資料，請稍後再試'\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import { render } from \"./UserEdit.vue?vue&type=template&id=4f920344\"\nimport script from \"./UserEdit.vue?vue&type=script&lang=js\"\nexport * from \"./UserEdit.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}